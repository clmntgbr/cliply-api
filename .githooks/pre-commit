#!/bin/sh

echo "ğŸ” Running code quality checks..."
echo ""

# Run PHP CS Fixer check
echo "ğŸ“ Checking code style with PHP CS Fixer..."
docker compose exec -T php composer cs-check
CS_FIXER_EXIT=$?

if [ $CS_FIXER_EXIT -ne 0 ]; then
    echo ""
    echo "âŒ PHP CS Fixer found issues!"
    echo "ğŸ’¡ Run 'docker compose exec php composer cs-fix' to fix them"
    echo ""
fi

# Run Rector check
echo ""
echo "ğŸ”§ Checking code with Rector..."
docker compose exec -T php composer rector-check
RECTOR_EXIT=$?

if [ $RECTOR_EXIT -ne 0 ]; then
    echo ""
    echo "âŒ Rector found issues!"
    echo "ğŸ’¡ Run 'docker compose exec php composer rector-fix' to fix them"
    echo ""
fi

# Run PHPStan check
echo ""
echo "ğŸ” Running static analysis with PHPStan..."
docker compose exec -T php composer phpstan
PHPSTAN_EXIT=$?

if [ $PHPSTAN_EXIT -ne 0 ]; then
    echo ""
    echo "âŒ PHPStan found issues!"
    echo "ğŸ’¡ Fix the issues reported above"
    echo ""
fi

# Exit with error if any check failed
if [ $CS_FIXER_EXIT -ne 0 ] || [ $RECTOR_EXIT -ne 0 ] || [ $PHPSTAN_EXIT -ne 0 ]; then
    echo "âŒ Commit aborted due to code quality issues"
    echo ""
    exit 1
fi

echo ""
echo "âœ… All checks passed!"
echo ""
exit 0

